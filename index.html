<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Office ‚Äî Agent HQ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #1a1a2e;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        
        .office-container {
            position: relative;
            width: clamp(320px, 90vw, 1440px);
            height: clamp(240px, 50vw, 800px);
            max-width: 1440px;
            background: linear-gradient(135deg, #f5f0e8 0%, #e8e0d5 100%);
            border-radius: clamp(4px, 1vw, 12px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            overflow: hidden;
            container-type: inline-size;
        }
        
        /* Mobile portrait - office with desks and beds */
        @media (max-width: 480px) and (orientation: portrait) {
            body {
                padding: 0;
                align-items: flex-start;
            }
            
            .office-container {
                width: 100vw;
                height: 100vh;
                height: 100dvh;
                max-width: 100vw;
                border-radius: 0;
                box-shadow: none;
            }
            
            /* HIDE UI clutter */
            .status-panel,
            .trophy-case,
            .trophy-button,
            .trophy-icon,
            .trophy-panel,
            #trophy-case,
            .sound-toggle,
            .mail-chute,
            .kitchen,
            .activity-feed,
            .portraits-gallery,
            .kanban-board,
            .kanban-modal,
            .armchair,
            .couch,
            .door,
            .window,
            .floating-agent,
            .night-lamp,
            .plant {
                display: none !important;
            }
            
            /* Bookshelf - top center */
            .bookshelf {
                top: 5%;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 380px;
                height: 80px;
                padding: 5px;
            }
            
            /* Birdcage - hanging on wall */
            .birdcage {
                top: 16% !important;
                bottom: auto !important;
                right: 8% !important;
                left: auto !important;
                transform: none !important;
                width: 35px !important;
                height: 50px !important;
                z-index: 10;
            }
            
            .birdcage::after {
                font-size: 20px !important;
            }
            
            /* Pool table - CENTER of room */
            .pool-table {
                display: block !important;
                position: absolute !important;
                top: 55% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) rotate(90deg) !important;
                width: 90px !important;
                height: 55px !important;
                z-index: 5 !important;
            }
            
            .pool-balls {
                display: block !important;
            }
            
            /* === DESKS on RIGHT SIDE (working agents) === */
            .workstation-row {
                position: absolute !important;
                top: 45% !important;
                bottom: auto !important;
                left: auto !important;
                right: 5% !important;
                transform: translateY(-50%) !important;
                display: flex !important;
                flex-direction: column !important;
                flex-wrap: nowrap !important;
                gap: 10px !important;
                justify-content: center !important;
                align-items: center !important;
                z-index: 20 !important;
            }
            
            .workstation {
                width: 55px !important;
                height: 48px !important;
                background: #a1887f !important;
                border-radius: 4px !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: flex-end !important;
                padding-bottom: 4px !important;
                position: relative !important;
                box-shadow: 0 3px 6px rgba(0,0,0,0.2) !important;
            }
            
            /* Desk surface */
            .workstation::before {
                content: '' !important;
                position: absolute !important;
                bottom: 0 !important;
                left: 2px !important;
                right: 2px !important;
                height: 12px !important;
                background: #5d4037 !important;
                border-radius: 2px !important;
            }
            
            /* Show ALL workstations on mobile - JS handles working state */
            .workstation,
            .workstation:not(.working),
            .workstation.working {
                display: flex !important;
            }
            
            .workstation .agent-icon {
                font-size: 22px !important;
                z-index: 2 !important;
                margin-bottom: 8px !important;
            }
            
            .workstation .agent-name {
                display: block !important;
                font-size: 6px !important;
                color: #333 !important;
                z-index: 2 !important;
            }
            
            /* Task badge above head */
            .workstation .ticket-badge {
                display: block !important;
                position: absolute !important;
                top: -16px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                background: #1976d2 !important;
                color: white !important;
                font-size: 6px !important;
                font-weight: bold !important;
                padding: 2px 4px !important;
                border-radius: 3px !important;
                white-space: nowrap !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.3) !important;
                z-index: 30 !important;
            }
            
            .status-dot {
                display: none !important;
            }
            
            /* === BEDS on LEFT SIDE (offline agents) === */
            .cots-area {
                display: flex !important;
                position: absolute !important;
                top: 45% !important;
                bottom: auto !important;
                left: 5% !important;
                right: auto !important;
                transform: translateY(-50%) !important;
                flex-direction: column !important;
                flex-wrap: nowrap !important;
                gap: 6px !important;
                justify-content: center !important;
                align-items: center !important;
                z-index: 15 !important;
            }
            
            .cot {
                display: flex !important;
                width: 50px !important;
                height: 28px !important;
                background: linear-gradient(180deg, #8d6e63 0%, #6d4c41 100%) !important;
                border-radius: 4px !important;
                position: relative !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .cot::before {
                content: '' !important;
                position: absolute !important;
                top: 3px !important;
                left: 3px !important;
                right: 3px !important;
                bottom: 3px !important;
                background: #e8e0d5 !important;
                border-radius: 2px !important;
            }
            
            .cot .pillow {
                position: absolute !important;
                top: 5px !important;
                left: 4px !important;
                width: 9px !important;
                height: 7px !important;
                background: #fff !important;
                border-radius: 2px !important;
                z-index: 1 !important;
            }
            
            .cot .sleeping-agent {
                position: relative !important;
                font-size: 13px !important;
                z-index: 2 !important;
                top: auto !important;
                left: auto !important;
            }
            
            .cot .zzz {
                position: absolute !important;
                top: -7px !important;
                right: 3px !important;
                font-size: 8px !important;
                z-index: 3 !important;
                color: #666 !important;
            }
        }
        
        /* Floor */
        .floor {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 70%;
            background: linear-gradient(180deg, #c9a66b 0%, #b8956a 100%);
        }
        
        .floor::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 60px,
                rgba(0,0,0,0.05) 60px,
                rgba(0,0,0,0.05) 61px
            );
        }
        
        /* Wall */
        .wall {
            position: absolute;
            top: 0;
            width: 100%;
            height: 35%;
            background: linear-gradient(180deg, #e8dfd0 0%, #ddd5c5 100%);
        }
        
        /* Agent Portraits Gallery */
        .portraits-gallery {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        
        .portrait {
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border: 2px solid #5d4037;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .portrait:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 20;
        }
        
        .portrait:hover::after {
            content: attr(data-name);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            white-space: nowrap;
            margin-top: 4px;
        }
        
        .portrait.working {
            border-color: #4caf50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }
        
        .portrait.sleeping {
            opacity: 0.5;
            filter: grayscale(30%);
        }
        
        /* Bookshelf */
        .bookshelf {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            height: 130px;
            background: #5d4037;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            padding: 8px;
            gap: 4px;
        }
        
        .shelf-row {
            flex: 1;
            display: flex;
            gap: 3px;
            align-items: flex-end;
            padding: 0 5px;
        }
        
        .book {
            height: 80%;
            width: 12px;
            border-radius: 2px 2px 0 0;
        }
        
        /* Pool Table */
        .pool-table {
            position: absolute;
            top: 50%;
            left: 35%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 100px;
            background: #1b5e20;
            border: 8px solid #5d4037;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .pool-balls {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }
        
        /* Couch */
        .couch {
            position: absolute;
            bottom: 120px;
            left: 40px;
            width: 120px;
            height: 50px;
            background: #2e7d32;
            border-radius: 8px 8px 4px 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .couch::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 5px;
            right: 5px;
            height: 30px;
            background: #388e3c;
            border-radius: 4px 4px 0 0;
        }
        
        /* Armchairs */
        .armchair {
            position: absolute;
            width: 45px;
            height: 40px;
            background: #5d4037;
            border-radius: 8px 8px 4px 4px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .armchair::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 8px;
            right: 8px;
            height: 20px;
            background: #6d4c41;
            border-radius: 4px 4px 0 0;
        }
        
        .armchair::after {
            content: 'ü™ë';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            opacity: 0.7;
        }
        
        /* Birdcage */
        .birdcage {
            position: absolute;
            bottom: 100px;
            right: 60px;
            width: 50px;
            height: 70px;
            border: 3px solid #ffd700;
            border-radius: 25px 25px 0 0;
            background: rgba(255,255,255,0.1);
        }
        
        .birdcage::after {
            content: 'ü¶ú';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }
        
        /* Kitchen */
        .kitchen {
            position: absolute;
            top: 60px;
            right: 20px;
            width: 100px;
            height: 80px;
            background: #6d4c41;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .kitchen::after {
            content: '‚òï';
            font-size: 24px;
        }
        
        /* Mail Chute */
        .mail-chute {
            position: absolute;
            bottom: 20px;
            right: 200px;
            width: 60px;
            height: 120px;
            background: linear-gradient(180deg, #1976d2 0%, #0d47a1 100%);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .mail-chute-tube {
            width: 20px;
            flex: 1;
            background: linear-gradient(90deg, #333 0%, #666 50%, #333 100%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .mail-chute-slot {
            width: 40px;
            height: 15px;
            background: #111;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        .mail-chute-label {
            font-size: 8px;
            color: white;
            text-align: center;
            margin-top: 5px;
            font-weight: bold;
        }
        
        /* Message animation */
        .message-flying {
            position: absolute;
            width: 15px;
            height: 10px;
            background: white;
            border-radius: 2px;
            animation: flyUp 0.8s ease-out forwards;
        }
        
        @keyframes flyUp {
            0% { bottom: 30px; opacity: 1; }
            100% { bottom: 150px; opacity: 0; }
        }
        
        /* Workstations */
        .workstation-row {
            position: absolute;
            bottom: 10px;
            left: 20px;
            display: flex;
            gap: 10px;
        }
        
        .workstation {
            width: 60px;
            height: 45px;
            background: #8d6e63;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .workstation:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .workstation.working {
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
        }
        
        .workstation .ticket-badge {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1976d2;
            color: white;
            font-size: 8px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 3px;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            animation: ticketFloat 2s ease-in-out infinite;
            display: none;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
        }
        
        .workstation .ticket-badge:hover {
            background: #1565c0;
            transform: translateX(-50%) scale(1.1);
            animation: none;
        }
        
        .workstation.working .ticket-badge {
            display: block;
        }
        
        @keyframes ticketFloat {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }
        
        .agent-icon {
            font-size: 20px;
        }
        
        .agent-name {
            font-size: 7px;
            color: white;
            margin-top: 2px;
        }
        
        .status-dot {
            position: absolute;
            top: 3px;
            right: 3px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9e9e9e;
        }
        
        .status-dot.working { background: #4caf50; }
        .status-dot.idle { background: #ff9800; }
        
        /* Floating Agents */
        .floating-agent {
            position: absolute;
            font-size: 24px;
            transition: all 1s ease-in-out;
            cursor: pointer;
        }
        
        .floating-agent:hover::after {
            content: attr(data-name);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
        }
        
        /* Plants */
        .plant {
            position: absolute;
            font-size: 24px;
        }
        
        /* Status Panel */
        .status-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 11px;
            max-width: 180px;
        }
        
        .status-panel h3 {
            font-size: 12px;
            margin-bottom: 8px;
            color: #4fc3f7;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 4px 0;
        }
        
        .status-item .icon {
            font-size: 14px;
        }

        /* Activity Feed Ticker */
        .activity-ticker {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(90deg, #1976d2 0%, #1565c0 100%);
            color: white;
            overflow: hidden;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
        }

        .ticker-content {
            display: flex;
            align-items: center;
            height: 100%;
            white-space: nowrap;
            animation: scroll 60s linear infinite;
        }

        .ticker-event {
            display: inline-flex;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        .ticker-event:hover {
            background: rgba(255,255,255,0.1);
        }

        .ticker-event .event-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        .ticker-event .event-time {
            margin-left: 10px;
            opacity: 0.8;
            font-size: 12px;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .ticker-paused .ticker-content {
            animation-play-state: paused;
        }
        
        /* Cots */
        .cots-area {
            position: absolute;
            top: 180px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .cot {
            width: 70px;
            height: 25px;
            background: linear-gradient(180deg, #8d6e63 0%, #6d4c41 100%);
            border-radius: 4px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .cot::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            right: 3px;
            bottom: 3px;
            background: #e8e0d5;
            border-radius: 2px;
        }
        
        .cot .pillow {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 15px;
            height: 12px;
            background: #fff;
            border-radius: 3px;
            z-index: 1;
        }
        
        .cot .sleeping-agent {
            position: absolute;
            top: -5px;
            left: 20px;
            font-size: 16px;
            z-index: 2;
        }
        
        .cot .zzz {
            position: absolute;
            top: -12px;
            right: 5px;
            font-size: 10px;
            color: #666;
            animation: zzz 2s ease-in-out infinite;
        }
        
        @keyframes zzz {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-3px); }
        }
        
        /* Pool game animation */
        @keyframes pool-game-shake {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(2deg); }
        }
        
        /* Agent interaction styles */
        .idle-animation-bubble {
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Movement personality styles */
        .floating-agent.rushing-movement {
            animation: rush 0.3s ease-in-out infinite;
        }
        
        .floating-agent.careful-movement {
            filter: drop-shadow(0 0 3px rgba(255, 255, 0, 0.5));
        }
        
        .floating-agent.relaxed-movement {
            animation: sway 2s ease-in-out infinite;
        }
        
        @keyframes rush {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes sway {
            0%, 100% { transform: rotate(-1deg); }
            50% { transform: rotate(1deg); }
        }
        
        /* Office Events Animations */
        @keyframes slideInFromTop {
            0% { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            100% { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @keyframes slideOutToTop {
            0% { transform: translateX(-50%) translateY(0); opacity: 1; }
            100% { transform: translateX(-50%) translateY(-100%); opacity: 0; }
        }
        
        @keyframes bobbing {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(10deg); }
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(200px) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Door */
        .door {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 80px;
            background: #5d4037;
            border-radius: 4px 4px 0 0;
            border: 3px solid #4e342e;
        }
        
        .door-handle {
            position: absolute;
            right: 8px;
            top: 50%;
            width: 8px;
            height: 8px;
            background: #ffd700;
            border-radius: 50%;
        }
        
        /* Window */
        .window {
            position: absolute;
            top: 40px;
            left: 30px;
            width: 80px;
            height: 60px;
            background: linear-gradient(180deg, #87ceeb 0%, #b0e0e6 100%);
            border: 4px solid #f5f5f5;
            border-radius: 4px;
        }
        
        /* Kanban Board */
        .kanban-board {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 60px;
            height: 40px;
            background: #2c3e50;
            border: 2px solid #34495e;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .kanban-board:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        
        /* Kanban Modal */
        .kanban-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .kanban-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            width: 95%;
            max-width: 1400px;
            height: 85vh;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
        }
        
        .kanban-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .kanban-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }
        
        .close-kanban {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.2s;
        }
        
        .close-kanban:hover {
            background: #c0392b;
        }
        
        .kanban-columns {
            display: flex;
            gap: 20px;
            flex: 1;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .kanban-column {
            flex: 1;
            min-width: 280px;
            background: #ffffff;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .column-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .backlog-header { background: #e3f2fd; color: #1976d2; }
        .progress-header { background: #fff3e0; color: #f57c00; }
        .review-header { background: #f3e5f5; color: #7b1fa2; }
        .done-header { background: #e8f5e8; color: #388e3c; }
        
        .column-count {
            background: rgba(0,0,0,0.1);
            color: inherit;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: normal;
        }
        
        .task-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 200px;
            padding: 8px;
            border-radius: 6px;
            border: 2px dashed transparent;
            transition: all 0.3s ease;
        }
        
        .task-list.drag-over {
            border-color: #007bff;
            background: rgba(0,123,255,0.05);
        }
        
        .task-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: grab;
            transition: all 0.2s ease;
            border-left: 4px solid #ddd;
        }
        
        .task-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            cursor: grabbing;
        }
        
        .task-card.high { border-left-color: #e74c3c; }
        .task-card.medium { border-left-color: #f39c12; }
        .task-card.low { border-left-color: #27ae60; }
        
        .task-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .task-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
            line-height: 1.3;
        }
        
        .task-id {
            font-size: 11px;
            color: #7f8c8d;
            background: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        .task-footer {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-top: 8px;
        }
        
        .task-assignee {
            font-size: 18px;
        }
        
        .task-tags {
            display: flex;
            gap: 4px;
        }
        
        .task-tag {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            background: #ecf0f1;
            color: #7f8c8d;
        }
        
        .add-task-btn {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            color: #6c757d;
            padding: 12px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .add-task-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
            color: #495057;
        }

        /* Responsive Container Queries for Overlap Prevention */
        @container (max-width: 480px) {
            /* DESKS - RIGHT SIDE */
            .workstation-row {
                position: absolute !important;
                top: 50% !important;
                bottom: auto !important;
                left: auto !important;
                right: 5% !important;
                transform: translateY(-50%) !important;
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
                flex-direction: column !important;
                gap: 8px !important;
                max-width: none !important;
                z-index: 100 !important;
            }
            
            .workstation {
                width: 52px !important;
                height: 45px !important;
                position: relative !important;
            }
            
            /* Show ALL workstations - JS controls working state */
            .workstation,
            .workstation:not(.working),
            .workstation.working {
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                background: #a1887f !important;
                border-radius: 4px !important;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important;
            }
            
            .workstation .agent-icon {
                font-size: 20px !important;
            }
            
            .workstation .ticket-badge {
                display: block !important;
                position: absolute !important;
                top: -14px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                background: #1976d2 !important;
                color: white !important;
                font-size: 6px !important;
                padding: 2px 4px !important;
                border-radius: 3px !important;
                white-space: nowrap !important;
                z-index: 100 !important;
            }
            
            .workstation .agent-name {
                display: block !important;
                font-size: 6px !important;
                color: #333 !important;
            }
            
            /* BEDS - LEFT SIDE */
            .cots-area {
                position: absolute !important;
                top: 50% !important;
                bottom: auto !important;
                left: 5% !important;
                right: auto !important;
                transform: translateY(-50%) !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 6px !important;
            }
            
            .cot {
                display: flex !important;
                width: 48px !important;
                height: 26px !important;
            }
            
            /* POOL TABLE - CENTER */
            .pool-table {
                width: 85px !important;
                height: 50px !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) rotate(90deg) !important;
            }
            
            .bookshelf {
                width: clamp(200px, 85vw, 380px);
                height: clamp(70px, 18vw, 90px);
                top: 15px;
            }
            
            /* Hide clutter */
            .couch, .portraits-gallery, .portrait, .status-panel,
            .trophy-case, #trophy-case, .sound-toggle, .mail-chute,
            .kitchen, .door, .window, .plant, .armchair, .night-lamp {
                display: none !important;
            }
        }

        @container (min-width: 481px) and (max-width: 768px) {
            .workstation-row {
                bottom: 8px;
                left: 15px;
                gap: 8px;
            }
            
            .workstation {
                width: clamp(50px, 8vw, 55px);
                height: clamp(38px, 6vw, 42px);
            }
            
            .pool-table {
                width: clamp(140px, 25vw, 160px);
                height: clamp(80px, 15vw, 90px);
                top: 45%;
                left: 40%;
            }
            
            .couch {
                width: clamp(100px, 20vw, 110px);
                height: clamp(40px, 8vw, 48px);
                bottom: 100px;
                left: 25px;
            }
            
            .bookshelf {
                width: clamp(350px, 70vw, 450px);
                height: clamp(100px, 18vw, 120px);
                top: 25px;
            }
        }

        @container (min-width: 769px) and (max-width: 1024px) {
            .pool-table {
                width: clamp(160px, 20vw, 180px);
                height: clamp(90px, 12vw, 100px);
                top: 50%;
                left: 35%;
            }
            
            .workstation-row {
                bottom: 10px;
                left: 20px;
                gap: 10px;
            }
        }

        @container (min-width: 1025px) {
            .office-container {
                width: clamp(900px, 80vw, 1440px);
                height: clamp(600px, 45vw, 900px);
            }
            
            .pool-table {
                width: 200px;
                height: 110px;
            }
        }

        /* Prevent overlaps with z-index management */
        .workstation-row { z-index: 10; }
        .pool-table { z-index: 5; }
        .couch { z-index: 6; }
        .armchair { z-index: 6; }
        .portraits-gallery { z-index: 15; }
        .bookshelf { z-index: 8; }

        /* Time-of-day lighting system */
        :root {
            --ambient-light: rgba(255, 255, 255, 0);
            --shadow-intensity: 0.4;
            --wall-brightness: 1;
            --floor-brightness: 1;
        }

        .office-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--ambient-light);
            pointer-events: none;
            transition: background 2s ease;
            z-index: 100;
        }

        /* Lighting variations */
        .lighting-morning {
            --ambient-light: linear-gradient(45deg, rgba(255, 220, 150, 0.15), rgba(255, 235, 180, 0.1));
            --wall-brightness: 1.1;
            --floor-brightness: 1.05;
        }

        .lighting-afternoon {
            --ambient-light: rgba(255, 255, 255, 0.02);
            --wall-brightness: 1;
            --floor-brightness: 1;
        }

        .lighting-evening {
            --ambient-light: linear-gradient(135deg, rgba(255, 150, 50, 0.2), rgba(255, 100, 30, 0.15));
            --wall-brightness: 0.9;
            --floor-brightness: 0.85;
        }

        .lighting-night {
            --ambient-light: linear-gradient(180deg, rgba(20, 20, 40, 0.6), rgba(10, 10, 30, 0.7));
            --shadow-intensity: 0.8;
            --wall-brightness: 0.3;
            --floor-brightness: 0.25;
        }

        .wall {
            filter: brightness(var(--wall-brightness));
            transition: filter 2s ease;
        }

        .floor {
            filter: brightness(var(--floor-brightness));
            transition: filter 2s ease;
        }

        /* Soft lamp glow for night time */
        .night-lamp {
            position: absolute;
            top: 60px;
            right: 100px;
            width: 30px;
            height: 40px;
            background: #fff8dc;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0;
            transition: opacity 2s ease;
            box-shadow: 0 0 30px rgba(255, 248, 220, 0.6);
        }

        .lighting-night .night-lamp {
            opacity: 1;
        }

        /* Agent Popover */
        .agent-popover {
            position: fixed;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 12px;
            padding: 16px;
            min-width: 280px;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .agent-popover.show {
            opacity: 1;
            transform: scale(1);
            pointer-events: all;
        }

        .popover-content {
            color: white;
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .agent-emoji {
            font-size: 32px;
        }

        .agent-header h3 {
            margin: 0;
            font-size: 18px;
            color: #fff;
        }

        .agent-status {
            margin-left: auto;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .agent-status.working {
            background: #4caf50;
            color: white;
        }

        .agent-status.idle {
            background: #ff9800;
            color: white;
        }

        .agent-status.offline {
            background: #666;
            color: #ccc;
        }

        .current-task {
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.4;
        }

        .current-task strong {
            color: #64b5f6;
            display: block;
            margin-bottom: 4px;
        }

        .task-info {
            color: #e0e0e0;
        }

        .popover-actions {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 12px;
        }

        .notion-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #2196f3;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.2s ease;
        }

        .notion-link:hover {
            background: #1976d2;
        }

        .notion-link::before {
            content: 'üìù';
        }

        /* Sound Controls */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .sound-toggle:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .sound-toggle.muted {
            opacity: 0.5;
        }

        /* Hide sound effects when prefers-reduced-motion */
        @media (prefers-reduced-motion: reduce) {
            .sound-toggle {
                display: none;
            }
        }
        /* FINAL MOBILE OVERRIDE */
        @media screen and (max-width: 500px) {
            /* === BEDS - LEFT SIDE (always visible) === */
            .cots-area {
                display: flex !important;
                position: absolute !important;
                top: 55% !important;
                left: 3% !important;
                transform: translateY(-50%) !important;
                flex-direction: column !important;
                gap: 3px !important;
                z-index: 50 !important;
            }
            
            .cot {
                display: flex !important;
                width: 46px !important;
                height: 24px !important;
                background: linear-gradient(180deg, #8d6e63 0%, #6d4c41 100%) !important;
                border-radius: 3px !important;
                position: relative !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .cot .pillow {
                position: absolute !important;
                left: 3px !important;
                top: 50% !important;
                transform: translateY(-50%) !important;
                width: 8px !important;
                height: 6px !important;
                background: white !important;
                border-radius: 2px !important;
            }
            
            /* Agent in bed - visible when NOT working */
            .cot .sleeping-agent {
                font-size: 12px !important;
                display: block !important;
            }
            
            .cot .zzz {
                position: absolute !important;
                top: -6px !important;
                right: 2px !important;
                font-size: 7px !important;
                display: block !important;
            }
            
            /* When agent is working, hide them from bed (bed is empty) */
            .cot.working .sleeping-agent,
            .cot.working .zzz {
                display: none !important;
            }
            
            /* === DESKS - RIGHT SIDE (always visible) === */
            .workstation-row {
                position: absolute !important;
                display: flex !important;
                top: 55% !important;
                right: 3% !important;
                left: auto !important;
                transform: translateY(-50%) !important;
                flex-direction: column !important;
                gap: 3px !important;
                z-index: 50 !important;
            }
            
            /* All desks visible (furniture stays) */
            .workstation {
                display: flex !important;
                width: 46px !important;
                height: 36px !important;
                background: #8d6e63 !important;
                border-radius: 4px !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                position: relative !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
            }
            
            /* Agent at desk - HIDDEN when NOT working (empty desk) */
            .workstation:not(.working) .agent-icon,
            .workstation:not(.working) .agent-name {
                display: none !important;
            }
            
            /* Agent at desk - visible when working */
            .workstation.working .agent-icon {
                display: block !important;
                font-size: 14px !important;
            }
            
            .workstation.working .agent-name {
                display: block !important;
            }
            
            /* Working desks get green glow */
            .workstation.working {
                box-shadow: 0 0 10px rgba(76, 175, 80, 0.7) !important;
            }
            
            .workstation .agent-icon {
                font-size: 14px !important;
            }
            
            .workstation .agent-name {
                font-size: 5px !important;
                color: #fff !important;
            }
            
            /* Task badge - positioned to left of desk so it doesn't get cut off */
            .workstation .ticket-badge {
                position: absolute !important;
                top: 50% !important;
                right: 100% !important;
                left: auto !important;
                transform: translateY(-50%) !important;
                margin-right: 4px !important;
                font-size: 6px !important;
                background: #1976d2 !important;
                color: white !important;
                padding: 2px 4px !important;
                border-radius: 3px !important;
                white-space: nowrap !important;
                z-index: 100 !important;
            }
            
            .workstation .ticket-badge:empty {
                display: none !important;
            }
            
            /* Birdcage - top right wall */
            .birdcage {
                top: 20% !important;
                right: 8% !important;
            }
            
            /* Popover - mobile friendly */
            .agent-popover {
                min-width: 250px !important;
                max-width: 90vw !important;
                padding: 12px !important;
            }
            
            .agent-popover .agent-emoji {
                font-size: 24px !important;
            }
            
            .agent-popover .agent-header h3 {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="office-container">
        <div class="wall"></div>
        <div class="floor"></div>
        
        <!-- Window -->
        <div class="window"></div>
        
        <!-- Kanban Board Access -->
        <div class="kanban-board" onclick="openKanban()" title="Open Kanban Board">
            üìã
        </div>
        
        <!-- Agent Portraits Gallery -->
        <div class="portraits-gallery">
            <div class="portrait working" data-name="Alice" data-agent="alice">ü¶ú</div>
            <div class="portrait working" data-name="Alpha" data-agent="alpha">üê∫</div>
            <div class="portrait" data-name="Beta" data-agent="beta">ü¶ä</div>
            <div class="portrait sleeping" data-name="Gamma" data-agent="gamma">ü¶î</div>
            <div class="portrait sleeping" data-name="Delta" data-agent="delta">ü¶â</div>
            <div class="portrait" data-name="Epsilon" data-agent="epsilon">üêô</div>
            <div class="portrait working" data-name="Zeta" data-agent="zeta">ü¶Ñ</div>
            <div class="portrait" data-name="Eta" data-agent="eta">üêº</div>
            <div class="portrait" data-name="Theta" data-agent="theta">ü¶ù</div>
        </div>
        
        <!-- Bookshelf -->
        <div class="bookshelf">
            <div class="shelf-row" id="shelf1"></div>
            <div class="shelf-row" id="shelf2"></div>
            <div class="shelf-row" id="shelf3"></div>
        </div>
        
        <!-- Kitchen -->
        <div class="kitchen"></div>
        
        <!-- Night Lamp -->
        <div class="night-lamp"></div>
        
        <!-- Sound Controls -->
        <div class="sound-toggle" id="soundToggle" onclick="toggleSound()" title="Toggle Sound Effects">
            üîä
        </div>
        
        <!-- Pool Table -->
        <div class="pool-table">
            <div class="pool-balls">üé±</div>
        </div>
        
        <!-- Birdcage -->
        <div class="birdcage"></div>
        
        <!-- Mail Chute -->
        <div class="mail-chute" id="mailChute" onclick="sendMail()">
            <div class="mail-chute-tube"></div>
            <div class="mail-chute-slot"></div>
            <div class="mail-chute-label">TELEGRAM</div>
        </div>
        
        <!-- Beds for ALL agents (one per agent) -->
        <div class="cots-area">
            <div class="cot" data-agent="alice">
                <div class="pillow"></div>
                <span class="sleeping-agent">ü¶ú</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="alpha">
                <div class="pillow"></div>
                <span class="sleeping-agent">üê∫</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="beta">
                <div class="pillow"></div>
                <span class="sleeping-agent">ü¶ä</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="gamma">
                <div class="pillow"></div>
                <span class="sleeping-agent">ü¶î</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="delta">
                <div class="pillow"></div>
                <span class="sleeping-agent">ü¶â</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="epsilon">
                <div class="pillow"></div>
                <span class="sleeping-agent">üêô</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="zeta">
                <div class="pillow"></div>
                <span class="sleeping-agent">ü¶Ñ</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="eta">
                <div class="pillow"></div>
                <span class="sleeping-agent">üêº</span>
                <span class="zzz">üí§</span>
            </div>
            <div class="cot" data-agent="theta">
                <div class="pillow"></div>
                <span class="sleeping-agent">ü¶ù</span>
                <span class="zzz">üí§</span>
            </div>
        </div>
        
        <!-- Plants -->
        <div class="plant" style="bottom: 180px; left: 170px;">ü™¥</div>
        <div class="plant" style="bottom: 180px; right: 150px;">ü™¥</div>
        <div class="plant" style="bottom: 80px; left: 180px;">üåø</div>
        
        <!-- Door -->
        <div class="door">
            <div class="door-handle"></div>
        </div>
        
        <!-- Workstations -->
        <div class="workstation-row">
            <div class="workstation working" data-agent="alice">
                <div class="ticket-badge" onclick="openNotionTask(this, event)">OFFICE-1-1</div>
                <div class="status-dot working"></div>
                <span class="agent-icon">ü¶ú</span>
                <span class="agent-name">Alice</span>
            </div>
            <div class="workstation working" data-agent="alpha">
                <div class="ticket-badge" onclick="openNotionTask(this, event)">OFFICE-1-2</div>
                <div class="status-dot working"></div>
                <span class="agent-icon">üê∫</span>
                <span class="agent-name">Alpha</span>
            </div>
            <div class="workstation" data-agent="beta">
                <div class="ticket-badge" onclick="openNotionTask(this, event)"></div>
                <div class="status-dot"></div>
                <span class="agent-icon">ü¶ä</span>
                <span class="agent-name">Beta</span>
            </div>
            <div class="workstation" data-agent="gamma">
                <div class="ticket-badge" onclick="openNotionTask(this, event)"></div>
                <div class="status-dot"></div>
                <span class="agent-icon">ü¶î</span>
                <span class="agent-name">Gamma</span>
            </div>
            <div class="workstation" data-agent="delta">
                <div class="ticket-badge" onclick="openNotionTask(this, event)"></div>
                <div class="status-dot"></div>
                <span class="agent-icon">ü¶â</span>
                <span class="agent-name">Delta</span>
            </div>
            <div class="workstation" data-agent="epsilon">
                <div class="ticket-badge" onclick="openNotionTask(this, event)"></div>
                <div class="status-dot"></div>
                <span class="agent-icon">üêô</span>
                <span class="agent-name">Epsilon</span>
            </div>
            <div class="workstation working" data-agent="zeta">
                <div class="ticket-badge" onclick="openNotionTask(this, event)">OFFICE-1-4</div>
                <div class="status-dot working"></div>
                <span class="agent-icon">ü¶Ñ</span>
                <span class="agent-name">Zeta</span>
            </div>
            <div class="workstation" data-agent="eta">
                <div class="ticket-badge" onclick="openNotionTask(this, event)"></div>
                <div class="status-dot"></div>
                <span class="agent-icon">üêº</span>
                <span class="agent-name">Eta</span>
            </div>
            <div class="workstation" data-agent="theta">
                <div class="ticket-badge" onclick="openNotionTask(this, event)"></div>
                <div class="status-dot"></div>
                <span class="agent-icon">ü¶ù</span>
                <span class="agent-name">Theta</span>
            </div>
        </div>
        
        <!-- Floating agents (when not at desk) -->
        <div class="floating-agent" id="agentAlpha" data-name="Alpha" style="display: none;">üê∫</div>
        
        <!-- Status Panel -->
        <div class="status-panel">
            <h3>üìä Office Status</h3>
            <div class="status-item"><span class="icon">ü¶ú</span> Alice ‚Äî Working</div>
            <div class="status-item"><span class="icon">üê∫</span> Alpha ‚Äî Idle</div>
            <div class="status-item"><span class="icon">ü¶ä</span> Beta ‚Äî Off</div>
        </div>
    </div>
    
    <!-- Agent Popover -->
    <div class="agent-popover" id="agentPopover">
        <div class="popover-content">
            <div class="agent-header">
                <span class="agent-emoji"></span>
                <h3 class="agent-name"></h3>
                <div class="agent-status"></div>
            </div>
            <div class="current-task">
                <strong>Current Task:</strong>
                <span class="task-info"></span>
            </div>
            <div class="popover-actions">
                <a href="#" class="notion-link" target="_blank">View Tasks in Notion</a>
            </div>
        </div>
    </div>
    
    <!-- Kanban Modal -->
    <div class="kanban-modal" id="kanbanModal">
        <div class="kanban-container">
            <div class="kanban-header">
                <h2 class="kanban-title">üè¢ Office Kanban Board</h2>
                <button class="close-kanban" onclick="closeKanban()">‚úï Close</button>
            </div>
            <div class="kanban-columns">
                <div class="kanban-column">
                    <div class="column-header backlog-header">
                        <span>üìã Backlog</span>
                        <span class="column-count" id="backlog-count">0</span>
                    </div>
                    <div class="task-list" id="backlog" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="add-task-btn" onclick="addTask('backlog')">+ Add Task</div>
                    </div>
                </div>
                
                <div class="kanban-column">
                    <div class="column-header progress-header">
                        <span>‚ö° In Progress</span>
                        <span class="column-count" id="progress-count">0</span>
                    </div>
                    <div class="task-list" id="progress" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="add-task-btn" onclick="addTask('progress')">+ Add Task</div>
                    </div>
                </div>
                
                <div class="kanban-column">
                    <div class="column-header review-header">
                        <span>üëÄ Review</span>
                        <span class="column-count" id="review-count">0</span>
                    </div>
                    <div class="task-list" id="review" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="add-task-btn" onclick="addTask('review')">+ Add Task</div>
                    </div>
                </div>
                
                <div class="kanban-column">
                    <div class="column-header done-header">
                        <span>‚úÖ Done</span>
                        <span class="column-count" id="done-count">0</span>
                    </div>
                    <div class="task-list" id="done" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="add-task-btn" onclick="addTask('done')">+ Add Task</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Generate colorful books
        const bookColors = ['#e53935', '#1e88e5', '#43a047', '#fb8c00', '#8e24aa', '#00acc1', '#6d4c41', '#546e7a'];
        
        function generateBooks() {
            for (let i = 1; i <= 3; i++) {
                const shelf = document.getElementById('shelf' + i);
                const bookCount = 20 + Math.floor(Math.random() * 10);
                for (let j = 0; j < bookCount; j++) {
                    const book = document.createElement('div');
                    book.className = 'book';
                    book.style.background = bookColors[Math.floor(Math.random() * bookColors.length)];
                    book.style.height = (60 + Math.random() * 30) + '%';
                    book.style.width = (8 + Math.random() * 8) + 'px';
                    shelf.appendChild(book);
                }
            }
        }
        
        // Mail chute animation
        function sendMail() {
            const chute = document.getElementById('mailChute');
            const message = document.createElement('div');
            message.className = 'message-flying';
            chute.appendChild(message);
            
            setTimeout(() => message.remove(), 800);
        }
        
        // Open Notion task in new tab
        // Mission Control Database ID: 2fe419064d3081bc8155ee2719c1d365
        const NOTION_DATABASE_ID = '2fe419064d3081bc8155ee2719c1d365';
        
        // Map task IDs to Notion page IDs
        const taskNotionPageIds = {
            'OFFICE-1-1': '30c419064d30817387120f7b046294393',
            'OFFICE-1-2': '30c419064d3081df845cd8a63699f65a',
            'OFFICE-1-3': '30c419064d3081c3bbded3253ba37c12',
            'OFFICE-1-4': '30c419064d30815fb66ae5000d88ca39',
            'OFFICE-2-1': '30c419064d30817c89e1db485c20a05e',
            'OFFICE-2-2': '30c419064d3081aabc7ef096b269ba0f',
            'OFFICE-2-3': '30c419064d308115bbaed06b7fbb64ce',
            'OFFICE-2-4': '30c419064d3081e18eadd0a495bde278',
            'OFFICE-3-1': '30c419064d30814c954bdc9587acc0b9',
            'OFFICE-3-2': '30c419064d30819db0bcd58a36caa244',
            'OFFICE-3-3': '30c419064d3081c68361cadcdf044211',
            'OFFICE-3-4': '30c419064d30816a9e4eea4545fbf237',
            'OFFICE-4-1': '30c419064d3081b2866dfd98adc25c36',
            'OFFICE-4-2': '30c419064d3081538fcbe5ce97f46606',
            'OFFICE-4-3': '30c419064d30817f860df1d07b54c0ad',
            'OFFICE-4-4': '30c419064d30817a901de067fe1c92e9',
            'OFFICE-5-1': '30c419064d30818c9c9ec4cd6af4a890',
            'OFFICE-5-2': '30c419064d3081b8a47cc1d386c50dae',
            'OFFICE-5-3': '30c419064d30813c8571e6ce5c808701',
            'OFFICE-5-4': '30c419064d3081a59387c12f555ffe38',
            'OFFICE-6-1': '30c419064d30817d8901ea80f0b91833',
            'OFFICE-6-2': '30c419064d3081f9a428d6e30b377cd0',
            'OFFICE-6-3': '30c419064d30814798d9d838a06645fd',
            'OFFICE-6-4': '30c419064d3081258943c1a223b58231',
            'OFFICE-7-1': '30c419064d308112baedcb412dc5a96b',
            'OFFICE-7-2': '30c419064d3081fcb54ed0ead4d30290',
            'OFFICE-7-3': '30c419064d3081fea957d7d491e8e4de',
            'OFFICE-7-4': '30c419064d3081d8ae23f0912b892fae',
            'OFFICE-8-1': '30c419064d3081ecbdfaf24bba86e99e',
            'OFFICE-8-2': '30c419064d3081d08c52d4832a37ccb2',
            'OFFICE-8-3': '30c419064d3081e3992bc59827a6c8e4',
            'OFFICE-8-4': '30c419064d30811b84a7d7f94bd171fc'
        };
        
        function openNotionTask(element, event) {
            event.stopPropagation(); // Prevent workstation click
            
            const taskId = element.textContent.trim();
            if (!taskId) return;
            
            // Check if we have a specific page ID for this task
            const pageId = taskNotionPageIds[taskId];
            
            let notionUrl;
            if (pageId) {
                // Open specific task page directly
                notionUrl = `https://notion.so/${pageId}`;
            } else {
                // Fallback: Open Mission Control board
                notionUrl = `https://notion.so/${NOTION_DATABASE_ID}`;
            }
            
            window.open(notionUrl, '_blank');
        }
        
        // Register a Notion page ID for a task (for dynamic updates)
        function registerNotionTask(taskId, notionPageId) {
            taskNotionPageIds[taskId] = notionPageId;
        }
        
        // Move agent to location
        function moveAgent(agentId, x, y) {
            const agent = document.getElementById(agentId);
            if (agent) {
                agent.style.display = 'block';
                agent.style.left = x + 'px';
                agent.style.top = y + 'px';
            }
        }
        
        // Time-of-day lighting system
        function updateLighting() {
            const now = new Date();
            const hour = now.getHours();
            const container = document.querySelector('.office-container');
            
            // Remove existing lighting classes
            container.classList.remove('lighting-morning', 'lighting-afternoon', 'lighting-evening', 'lighting-night');
            
            // Apply appropriate lighting based on time
            if (hour >= 6 && hour < 12) {
                // Morning: warm bright light
                container.classList.add('lighting-morning');
            } else if (hour >= 12 && hour < 18) {
                // Afternoon: neutral
                container.classList.add('lighting-afternoon');
            } else if (hour >= 18 && hour < 22) {
                // Evening: orange/sunset tint
                container.classList.add('lighting-evening');
            } else {
                // Night: dark with soft lamp glow
                container.classList.add('lighting-night');
            }
        }
        
        // Sound effects system using Web Audio API
        class SoundSystem {
            constructor() {
                this.audioContext = null;
                this.isMuted = localStorage.getItem('soundMuted') === 'true';
                this.prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                this.initAudioContext();
                this.updateToggleIcon();
            }
            
            initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.warn('Web Audio API not supported');
                }
            }
            
            async resumeAudioContext() {
                if (this.audioContext && this.audioContext.state === 'suspended') {
                    await this.audioContext.resume();
                }
            }
            
            createTone(frequency, duration, type = 'sine', volume = 0.1) {
                if (!this.audioContext || this.isMuted || this.prefersReducedMotion) return;
                
                this.resumeAudioContext();
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = type;
                
                // Envelope for smooth sound
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            playTaskComplete() {
                // Pleasant chime - ascending arpeggio
                const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        this.createTone(freq, 0.3, 'sine', 0.08);
                    }, index * 150);
                });
            }
            
            playTaskAssigned() {
                // Soft ping - gentle notification
                this.createTone(800, 0.2, 'sine', 0.06);
                setTimeout(() => {
                    this.createTone(1000, 0.2, 'sine', 0.04);
                }, 100);
            }
            
            toggle() {
                this.isMuted = !this.isMuted;
                localStorage.setItem('soundMuted', this.isMuted.toString());
                this.updateToggleIcon();
                
                // Play a test sound when unmuting
                if (!this.isMuted && !this.prefersReducedMotion) {
                    setTimeout(() => this.playTaskAssigned(), 100);
                }
            }
            
            updateToggleIcon() {
                const toggle = document.getElementById('soundToggle');
                if (toggle) {
                    toggle.textContent = this.isMuted ? 'üîá' : 'üîä';
                    toggle.classList.toggle('muted', this.isMuted);
                }
            }
        }
        
        // Initialize sound system
        const soundSystem = new SoundSystem();
        
        // Global functions for sound control
        function toggleSound() {
            soundSystem.toggle();
        }
        
        function playTaskCompleteSound() {
            soundSystem.playTaskComplete();
        }
        
        function playTaskAssignedSound() {
            soundSystem.playTaskAssigned();
        }

        // Agent popover system
        const agentData = {
            'alice': {
                name: 'Alice',
                emoji: 'ü¶ú',
                status: 'working',
                currentTask: 'Building Office Canvas Interface',
                taskId: 'OFFICE-1-1'
            },
            'alpha': {
                name: 'Alpha',
                emoji: 'üê∫',
                status: 'working',
                currentTask: 'Sprite System Implementation',
                taskId: 'OFFICE-1-2'
            },
            'beta': {
                name: 'Beta',
                emoji: 'ü¶ä',
                status: 'offline',
                currentTask: 'No active tasks',
                taskId: null
            },
            'gamma': {
                name: 'Gamma',
                emoji: 'ü¶î',
                status: 'offline',
                currentTask: 'No active tasks',
                taskId: null
            },
            'delta': {
                name: 'Delta',
                emoji: 'ü¶â',
                status: 'offline',
                currentTask: 'No active tasks',
                taskId: null
            },
            'epsilon': {
                name: 'Epsilon',
                emoji: 'üêô',
                status: 'offline',
                currentTask: 'No active tasks',
                taskId: null
            },
            'zeta': {
                name: 'Zeta',
                emoji: 'ü¶Ñ',
                status: 'working',
                currentTask: 'Testing Infrastructure',
                taskId: 'OFFICE-1-3'
            },
            'eta': {
                name: 'Eta',
                emoji: 'üêº',
                status: 'offline',
                currentTask: 'No active tasks',
                taskId: null
            },
            'theta': {
                name: 'Theta',
                emoji: 'ü¶ù',
                status: 'offline',
                currentTask: 'No active tasks',
                taskId: null
            }
        };

        function showAgentPopover(agentId, event) {
            event.stopPropagation();
            const popover = document.getElementById('agentPopover');
            const agent = agentData[agentId];
            
            if (!agent) return;
            
            // Update popover content
            popover.querySelector('.agent-emoji').textContent = agent.emoji;
            popover.querySelector('.agent-name').textContent = agent.name;
            popover.querySelector('.task-info').textContent = agent.currentTask;
            
            const statusEl = popover.querySelector('.agent-status');
            statusEl.textContent = agent.status;
            statusEl.className = 'agent-status ' + agent.status;
            
            // Update Notion link
            const notionLink = popover.querySelector('.notion-link');
            if (agent.taskId && taskNotionPageIds[agent.taskId]) {
                notionLink.href = `https://notion.so/${taskNotionPageIds[agent.taskId]}`;
                notionLink.style.display = 'inline-flex';
            } else {
                notionLink.style.display = 'none';
            }
            
            // Position popover near the workstation (with viewport bounds check)
            const rect = event.target.closest('.workstation').getBoundingClientRect();
            const popoverWidth = 300;
            const popoverHeight = 220;
            const padding = 10;
            
            // Calculate initial position
            let left = rect.left + rect.width / 2 - popoverWidth / 2;
            let top = rect.top - popoverHeight - 10;
            
            // Keep within horizontal bounds
            if (left < padding) {
                left = padding;
            } else if (left + popoverWidth > window.innerWidth - padding) {
                left = window.innerWidth - popoverWidth - padding;
            }
            
            // Keep within vertical bounds - if too high, show below the desk
            if (top < padding) {
                top = rect.bottom + 10;
            }
            
            // If still off-screen at bottom, center vertically
            if (top + popoverHeight > window.innerHeight - padding) {
                top = Math.max(padding, (window.innerHeight - popoverHeight) / 2);
            }
            
            popover.style.left = left + 'px';
            popover.style.top = top + 'px';
            
            // Show popover
            popover.classList.add('show');
            
            // Play a subtle interaction sound
            setTimeout(() => {
                soundSystem.createTone(600, 0.1, 'sine', 0.03);
            }, 50);
        }

        function hideAgentPopover() {
            document.getElementById('agentPopover').classList.remove('show');
        }

        // Add click handlers to workstations
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.workstation').forEach(workstation => {
                workstation.addEventListener('click', (e) => {
                    const agentId = workstation.getAttribute('data-agent');
                    showAgentPopover(agentId, e);
                });
            });
            
            // Hide popover when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.agent-popover') && !e.target.closest('.workstation')) {
                    hideAgentPopover();
                }
            });
        });

        // Initialize
        generateBooks();
        updateLighting();
        
        // Update lighting every 10 minutes
        setInterval(updateLighting, 600000);
        
        // Demo: move Alpha around occasionally - DISABLED to prevent state conflicts
        // setInterval(() => {
        //     const positions = [
        //         { x: 400, y: 280 },  // pool table
        //         { x: 100, y: 350 },  // couch
        //         { x: 750, y: 150 },  // kitchen
        //     ];
        //     const pos = positions[Math.floor(Math.random() * positions.length)];
        //     moveAgent('agentAlpha', pos.x, pos.y);
        // }, 5000);
        
        // Kanban Board Functionality
        let tasks = [
            {
                id: 'OFFICE-1-1',
                title: 'Build Office Canvas Interface',
                assignee: 'ü¶ú',
                priority: 'high',
                tags: ['frontend', 'canvas'],
                column: 'progress'
            },
            {
                id: 'OFFICE-1-2',
                title: 'Create Kanban Board Component',
                assignee: 'üê∫',
                priority: 'high',
                tags: ['frontend', 'kanban'],
                column: 'progress'
            },
            {
                id: 'OFFICE-1-3',
                title: 'Add Drag & Drop Functionality',
                assignee: 'üê∫',
                priority: 'medium',
                tags: ['javascript', 'UX'],
                column: 'backlog'
            },
            {
                id: 'OFFICE-1-4',
                title: 'Deploy to GitHub Pages',
                assignee: 'ü¶Ñ',
                priority: 'low',
                tags: ['deployment', 'github'],
                column: 'backlog'
            },
            {
                id: 'OFFICE-2-1',
                title: 'Add Agent Status Updates',
                assignee: 'ü¶ä',
                priority: 'medium',
                tags: ['backend', 'realtime'],
                column: 'backlog'
            },
            {
                id: 'OFFICE-2-2',
                title: 'Create Task Assignment System',
                assignee: 'ü¶î',
                priority: 'low',
                tags: ['backend', 'workflow'],
                column: 'backlog'
            }
        ];
        
        let draggedElement = null;
        
        function openKanban() {
            document.getElementById('kanbanModal').style.display = 'flex';
            renderTasks();
        }
        
        function closeKanban() {
            document.getElementById('kanbanModal').style.display = 'none';
        }
        
        function renderTasks() {
            const columns = ['backlog', 'progress', 'review', 'done'];
            
            columns.forEach(column => {
                const taskList = document.getElementById(column);
                if (!taskList) {
                    console.error(`Kanban column not found: ${column}`);
                    return;
                }
                const addBtn = taskList.querySelector('.add-task-btn');
                
                // Clear existing tasks (but keep add button)
                Array.from(taskList.children).forEach(child => {
                    if (!child.classList.contains('add-task-btn')) {
                        child.remove();
                    }
                });
                
                // Add tasks for this column
                const columnTasks = tasks.filter(task => task.column === column);
                columnTasks.forEach(task => {
                    const taskElement = createTaskElement(task);
                    taskList.insertBefore(taskElement, addBtn);
                });
                
                // Update count
                const countElement = document.getElementById(column + '-count');
                if (countElement) {
                    countElement.textContent = columnTasks.length;
                } else {
                    console.warn(`Count element not found: ${column}-count`);
                }
            });
        }
        
        function createTaskElement(task) {
            const taskDiv = document.createElement('div');
            taskDiv.className = `task-card ${task.priority}`;
            taskDiv.draggable = true;
            taskDiv.dataset.taskId = task.id;
            taskDiv.ondragstart = drag;
            
            const tagsHtml = task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('');
            
            taskDiv.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <div class="task-id">${task.id}</div>
                </div>
                <div class="task-footer">
                    <div class="task-assignee">${task.assignee}</div>
                    <div class="task-tags">${tagsHtml}</div>
                </div>
            `;
            
            return taskDiv;
        }
        
        function drag(ev) {
            draggedElement = ev.target;
            ev.target.classList.add('dragging');
        }
        
        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('drag-over');
        }
        
        function drop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');
            
            if (draggedElement && ev.currentTarget.classList.contains('task-list')) {
                const taskId = draggedElement.dataset.taskId;
                const newColumn = ev.currentTarget.id;
                const addBtn = ev.currentTarget.querySelector('.add-task-btn');
                
                // Update task data
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    const oldColumn = task.column;
                    task.column = newColumn;
                    
                    // Play sound effects based on column change
                    if (newColumn === 'done' && oldColumn !== 'done') {
                        // Task completed - pleasant chime
                        setTimeout(() => playTaskCompleteSound(), 100);
                    } else if (oldColumn === 'backlog' && newColumn === 'progress') {
                        // Task assigned - soft ping
                        setTimeout(() => playTaskAssignedSound(), 100);
                    }
                }
                
                // Move element
                ev.currentTarget.insertBefore(draggedElement, addBtn);
                draggedElement.classList.remove('dragging');
                
                // Update counts
                renderTasks();
            }
            
            // Clean up
            document.querySelectorAll('.task-list').forEach(list => {
                list.classList.remove('drag-over');
            });
            document.querySelectorAll('.task-card').forEach(card => {
                card.classList.remove('dragging');
            });
            
            draggedElement = null;
        }
        
        function addTask(column) {
            const title = prompt('Enter task title:');
            if (!title) return;
            
            const assignees = ['ü¶ú', 'üê∫', 'ü¶ä', 'ü¶î', 'ü¶â', 'üêô', 'ü¶Ñ', 'üêº', 'ü¶ù'];
            const priorities = ['low', 'medium', 'high'];
            const tagOptions = ['frontend', 'backend', 'design', 'testing', 'deployment', 'documentation'];
            
            const newTask = {
                id: 'TASK-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                title: title,
                assignee: assignees[Math.floor(Math.random() * assignees.length)],
                priority: priorities[Math.floor(Math.random() * priorities.length)],
                tags: [tagOptions[Math.floor(Math.random() * tagOptions.length)]],
                column: column
            };
            
            tasks.push(newTask);
            renderTasks();
        }
        
        // Close modal when clicking outside
        document.getElementById('kanbanModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeKanban();
            }
        });
        
        // Prevent drag events from bubbling to modal
        document.addEventListener('dragover', function(e) {
            if (!e.target.classList.contains('task-list')) {
                e.preventDefault();
            }
        });
    </script>
    
    <!-- üêô EPSILON'S STATE MANAGEMENT SYSTEM -->
    <script src="office-state.js"></script>
    
    <!-- ü¶â DELTA'S ACHIEVEMENTS & CELEBRATIONS SYSTEM -->
    <script src="achievements-system.js"></script>
    <script src="achievement-enhancements.js"></script>
    
    <!-- üéØ REAL-TIME BADGE SYNC SYSTEM -->
    <script>
        // Real-time badge sync from Cloudflare Worker
        const WORKER_ENDPOINT = 'https://office-notion-proxy.your-worker-domain.workers.dev/api/tasks';
        const AGENT_NAME_MAP = {
            'alice': ['Alice', 'alice', 'ALICE'],
            'alpha': ['Alpha', 'Worker-Alpha', 'ALPHA', 'alpha'],
            'beta': ['Beta', 'Worker-Beta', 'BETA', 'beta'], 
            'gamma': ['Gamma', 'Worker-Gamma', 'GAMMA', 'gamma'],
            'delta': ['Delta', 'Worker-Delta', 'DELTA', 'delta'],
            'epsilon': ['Epsilon', 'Worker-Epsilon', 'EPSILON', 'epsilon'],
            'zeta': ['Zeta', 'Worker-Zeta', 'ZETA', 'zeta'],
            'eta': ['Eta', 'Worker-Eta', 'ETA', 'eta'],
            'theta': ['Theta', 'Worker-Theta', 'THETA', 'theta']
        };

        let lastSyncTime = null;
        let currentTasks = [];

        async function syncBadgesFromWorker() {
            try {
                console.log('üîÑ Syncing badges from Cloudflare Worker...');
                
                const response = await fetch(WORKER_ENDPOINT);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                if (!data.success) {
                    throw new Error(data.error || 'Worker returned error');
                }

                currentTasks = data.tasks;
                lastSyncTime = new Date().toISOString();
                
                updateAgentBadges(data.tasks);
                console.log(`‚úÖ Synced ${data.tasks.length} tasks from Mission Control`);
                
            } catch (error) {
                console.error('‚ùå Badge sync failed:', error);
                // Fallback to demo data if worker unavailable
                useDemoData();
            }
        }

        function updateAgentBadges(tasks) {
            // Clear all existing badges and working status
            document.querySelectorAll('.workstation').forEach(workstation => {
                const badge = workstation.querySelector('.ticket-badge');
                const statusDot = workstation.querySelector('.status-dot');
                const agentKey = workstation.getAttribute('data-agent');
                
                badge.textContent = '';
                badge.style.display = 'none';
                workstation.classList.remove('working');
                statusDot.classList.remove('working');
                
                // Also update the matching bed - agent goes to bed when not working
                const bed = document.querySelector(`.cot[data-agent="${agentKey}"]`);
                if (bed) {
                    bed.classList.remove('working');
                }
            });

            // Update badges with active tasks
            tasks.forEach(task => {
                if (!task.assignee || task.status === 'Complete') return;

                const agentKey = findAgentKey(task.assignee);
                if (agentKey) {
                    const workstation = document.querySelector(`.workstation[data-agent="${agentKey}"]`);
                    if (workstation) {
                        const badge = workstation.querySelector('.ticket-badge');
                        const statusDot = workstation.querySelector('.status-dot');
                        
                        badge.textContent = task.taskId;
                        badge.style.display = 'block';
                        badge.onclick = (e) => openNotionTask(badge, e, task.url);
                        
                        // Update working status based on task status
                        if (task.status === 'In Progress') {
                            workstation.classList.add('working');
                            statusDot.classList.add('working');
                            
                            // Also update the matching bed - agent leaves bed when working
                            const bed = document.querySelector(`.cot[data-agent="${agentKey}"]`);
                            if (bed) {
                                bed.classList.add('working');
                            }
                        }
                    }
                }
            });
        }

        function findAgentKey(assigneeName) {
            for (const [key, variants] of Object.entries(AGENT_NAME_MAP)) {
                if (variants.some(variant => 
                    assigneeName.toLowerCase().includes(variant.toLowerCase()) ||
                    variant.toLowerCase().includes(assigneeName.toLowerCase())
                )) {
                    return key;
                }
            }
            return null;
        }

        function useDemoData() {
            console.log('üé≠ Using demo data (Worker unavailable)');
            updateAgentBadges([
                { taskId: 'OFFICE-1-1', assignee: 'Alice', status: 'In Progress', url: 'https://notion.so/demo' },
                { taskId: 'OFFICE-1-2', assignee: 'Worker-Alpha', status: 'In Progress', url: 'https://notion.so/demo' },
                { taskId: 'OFFICE-1-4', assignee: 'Zeta', status: 'In Progress', url: 'https://notion.so/demo' }
            ]);
        }

        // Enhanced openNotionTask with URL support
        function openNotionTask(element, event, taskUrl = null) {
            event.stopPropagation();
            
            const taskId = element.textContent.trim();
            if (!taskId) return;

            // Use provided URL or fallback to existing logic
            if (taskUrl) {
                window.open(taskUrl, '_blank');
                return;
            }

            // Existing fallback logic
            const pageId = taskNotionPageIds[taskId];
            let notionUrl;
            if (pageId) {
                notionUrl = `https://www.notion.so/${pageId}`;
            } else {
                // Generic Mission Control board URL
                notionUrl = `https://www.notion.so/2fe419064d3081bc8155ee2719c1d365`;
            }
            
            window.open(notionUrl, '_blank');
        }

        // Auto-sync every 30 seconds
        function startBadgeSync() {
            syncBadgesFromWorker(); // Initial sync
            setInterval(syncBadgesFromWorker, 30000);
        }

        // Export for debugging
        window.badgeSync = {
            sync: syncBadgesFromWorker,
            tasks: () => currentTasks,
            lastSync: () => lastSyncTime
        };
    </script>

    <!-- üó∫Ô∏è AGENT LOCATION AWARENESS SYSTEM -->
    <script>
        // Agent location states and positions
        const AGENT_LOCATIONS = {
            desk: 'workstation', // agents at their workstations
            pool: { x: 400, y: 280 }, // pool table area
            kitchen: { x: 800, y: 100 }, // kitchen area  
            cot: 'sleeping' // sleeping in cots
        };

        let agentStates = {
            alice: { location: 'desk', status: 'working', element: null },
            alpha: { location: 'desk', status: 'working', element: null },
            beta: { location: 'pool', status: 'idle', element: null },
            gamma: { location: 'cot', status: 'sleeping', element: null },
            delta: { location: 'cot', status: 'sleeping', element: null },
            epsilon: { location: 'pool', status: 'idle', element: null },
            zeta: { location: 'desk', status: 'working', element: null },
            eta: { location: 'kitchen', status: 'idle', element: null },
            theta: { location: 'kitchen', status: 'idle', element: null }
        };

        const AGENT_ICONS = {
            alice: 'ü¶ú', alpha: 'üê∫', beta: 'ü¶ä', gamma: 'ü¶î', delta: 'ü¶â',
            epsilon: 'üêô', zeta: 'ü¶Ñ', eta: 'üêº', theta: 'ü¶ù'
        };

        function initializeAgentLocations() {
            console.log('üó∫Ô∏è Initializing agent location awareness...');
            
            // Create floating agent elements for each agent
            Object.keys(agentStates).forEach(agentKey => {
                if (agentKey === 'alice') return; // Alice stays at desk
                
                const floatingAgent = document.createElement('div');
                floatingAgent.className = 'floating-agent';
                floatingAgent.id = `agent${agentKey.charAt(0).toUpperCase() + agentKey.slice(1)}`;
                floatingAgent.setAttribute('data-name', agentKey.charAt(0).toUpperCase() + agentKey.slice(1));
                floatingAgent.textContent = AGENT_ICONS[agentKey];
                floatingAgent.style.display = 'none';
                
                document.body.appendChild(floatingAgent);
                agentStates[agentKey].element = floatingAgent;
            });

            // Position agents based on initial states
            updateAllAgentLocations();
        }

        function updateAgentLocation(agentKey, newLocation, newStatus = null) {
            if (!agentStates[agentKey]) return;
            
            const agent = agentStates[agentKey];
            const oldLocation = agent.location;
            
            agent.location = newLocation;
            if (newStatus) agent.status = newStatus;
            
            console.log(`üó∫Ô∏è ${agentKey}: ${oldLocation} ‚Üí ${newLocation} (${agent.status})`);
            
            // Update workstation visibility
            const workstation = document.querySelector(`[data-agent="${agentKey}"]`);
            if (workstation) {
                const statusDot = workstation.querySelector('.status-dot');
                
                if (newLocation === 'desk') {
                    // Show at workstation
                    if (agent.element) agent.element.style.display = 'none';
                    workstation.style.display = 'block';
                    
                    if (newStatus === 'working') {
                        statusDot.classList.remove('idle');
                        statusDot.classList.add('working');
                    } else {
                        statusDot.classList.remove('working'); 
                        statusDot.classList.add('idle');
                    }
                } else {
                    // Hide from workstation, show as floating
                    if (agent.element) {
                        agent.element.style.display = 'block';
                        moveAgentToLocation(agentKey, newLocation);
                    }
                    statusDot.classList.remove('working');
                    statusDot.classList.add('idle');
                }
            }
            
            // Handle cot assignments
            if (newLocation === 'cot') {
                assignToCot(agentKey);
            } else if (oldLocation === 'cot') {
                clearFromCot(agentKey);
            }
        }

        function moveAgentToLocation(agentKey, location) {
            const agent = agentStates[agentKey];
            if (!agent.element) return;
            
            const element = agent.element;
            
            if (location === 'pool') {
                element.style.left = AGENT_LOCATIONS.pool.x + 'px';
                element.style.top = AGENT_LOCATIONS.pool.y + 'px';
            } else if (location === 'kitchen') {
                element.style.left = AGENT_LOCATIONS.kitchen.x + 'px';
                element.style.top = AGENT_LOCATIONS.kitchen.y + 'px';
            }
        }

        function assignToCot(agentKey) {
            // Find available cot
            const cots = document.querySelectorAll('.cot');
            for (let cot of cots) {
                if (!cot.querySelector('.sleeping-agent')) {
                    const sleepingAgent = document.createElement('span');
                    sleepingAgent.className = 'sleeping-agent';
                    sleepingAgent.setAttribute('data-agent', agentKey);
                    sleepingAgent.textContent = AGENT_ICONS[agentKey];
                    
                    const zzz = document.createElement('span');
                    zzz.className = 'zzz';
                    zzz.textContent = 'üí§';
                    
                    cot.appendChild(sleepingAgent);
                    cot.appendChild(zzz);
                    
                    // Hide floating element
                    if (agentStates[agentKey].element) {
                        agentStates[agentKey].element.style.display = 'none';
                    }
                    break;
                }
            }
        }

        function clearFromCot(agentKey) {
            const sleepingAgent = document.querySelector(`[data-agent="${agentKey}"].sleeping-agent`);
            if (sleepingAgent) {
                const cot = sleepingAgent.parentElement;
                const zzz = cot.querySelector('.zzz');
                if (zzz) zzz.remove();
                sleepingAgent.remove();
            }
        }

        function updateAllAgentLocations() {
            Object.keys(agentStates).forEach(agentKey => {
                const agent = agentStates[agentKey];
                updateAgentLocation(agentKey, agent.location, agent.status);
            });
        }

        // Smart location assignment based on agent activity
        function updateAgentLocationFromTask(agentKey, hasActiveTask) {
            if (!agentStates[agentKey]) return;
            
            if (hasActiveTask) {
                // Working agents go to desk
                updateAgentLocation(agentKey, 'desk', 'working');
            } else {
                // Idle agents go to pool or kitchen randomly
                const idleLocations = ['pool', 'kitchen'];
                const randomLocation = idleLocations[Math.floor(Math.random() * idleLocations.length)];
                updateAgentLocation(agentKey, randomLocation, 'idle');
            }
        }

        // Enhanced badge sync to include location updates
        const originalUpdateAgentBadges = updateAgentBadges;
        updateAgentBadges = function(tasks) {
            originalUpdateAgentBadges(tasks);
            
            // Update locations based on task assignments
            Object.keys(agentStates).forEach(agentKey => {
                if (agentKey === 'alice') return; // Alice stays put
                
                const hasTask = tasks.some(task => {
                    const assigneeKey = findAgentKey(task.assignee);
                    return assigneeKey === agentKey && task.status !== 'Complete';
                });
                
                updateAgentLocationFromTask(agentKey, hasTask);
            });
        };

        // Periodic location shuffling for idle agents
        function shuffleIdleAgents() {
            Object.keys(agentStates).forEach(agentKey => {
                const agent = agentStates[agentKey];
                if (agent.status === 'idle' && agent.location !== 'desk') {
                    // 20% chance to move to a different idle location
                    if (Math.random() < 0.2) {
                        const idleLocations = ['pool', 'kitchen'];
                        const currentIndex = idleLocations.indexOf(agent.location);
                        const newLocation = idleLocations[1 - currentIndex]; // switch
                        updateAgentLocation(agentKey, newLocation, 'idle');
                    }
                }
            });
        }

        // Export for debugging
        window.locationSystem = {
            states: agentStates,
            moveAgent: updateAgentLocation,
            shuffle: shuffleIdleAgents,
            init: initializeAgentLocations
        };
    </script>

    <!-- üì∞ ACTIVITY FEED TICKER SYSTEM -->
    <script>
        let activityEvents = [];
        const MAX_EVENTS = 10;

        function addActivityEvent(type, message, agentIcon = '', notionUrl = null) {
            const event = {
                id: Date.now() + Math.random(),
                type: type, // 'claim', 'complete', 'assign', 'move'
                message: message,
                icon: getEventIcon(type),
                agentIcon: agentIcon,
                timestamp: new Date(),
                notionUrl: notionUrl
            };

            activityEvents.unshift(event); // Add to front
            
            // Keep only latest MAX_EVENTS
            if (activityEvents.length > MAX_EVENTS) {
                activityEvents = activityEvents.slice(0, MAX_EVENTS);
            }

            updateTickerDisplay();
            console.log(`üì∞ Activity: ${message}`);
        }

        function getEventIcon(type) {
            const icons = {
                claim: 'üéØ',
                complete: '‚úÖ', 
                assign: 'üìã',
                move: 'üö∂',
                sync: 'üîÑ',
                wake: '‚òï',
                sleep: 'üí§'
            };
            return icons[type] || 'üì∞';
        }

        function updateTickerDisplay() {
            const tickerContent = document.getElementById('tickerContent');
            if (!tickerContent) return;

            tickerContent.innerHTML = activityEvents.map(event => {
                const timeAgo = getTimeAgo(event.timestamp);
                return `
                    <div class="ticker-event" onclick="openEventUrl('${event.notionUrl || ''}', '${event.type}')">
                        <span class="event-icon">${event.icon}</span>
                        <span class="event-agent">${event.agentIcon}</span>
                        <span class="event-message">${event.message}</span>
                        <span class="event-time">${timeAgo}</span>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const diffMs = now - timestamp;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);

            if (diffMins < 1) return 'now';
            if (diffMins < 60) return `${diffMins}m`;
            if (diffHours < 24) return `${diffHours}h`;
            return timestamp.toLocaleDateString();
        }

        function openEventUrl(notionUrl, eventType) {
            if (notionUrl && notionUrl !== 'null' && notionUrl !== '') {
                window.open(notionUrl, '_blank');
            } else {
                // Fallback to Mission Control board
                window.open('https://www.notion.so/2fe419064d3081bc8155ee2719c1d365', '_blank');
            }
        }

        // Hook into existing systems to generate activity
        function initializeActivityFeed() {
            console.log('üì∞ Initializing activity feed ticker...');

            // Add initial demo events
            addActivityEvent('sync', 'Office systems initialized', 'üè¢');
            
            setTimeout(() => {
                addActivityEvent('wake', 'Alice started her shift', 'ü¶ú');
            }, 2000);

            setTimeout(() => {
                addActivityEvent('claim', 'Worker-Alpha claimed OFFICE-FIX-1', 'üê∫');
            }, 4000);
        }

        // Hook into badge sync to track task events
        const originalSyncBadges = syncBadgesFromWorker;
        syncBadgesFromWorker = async function() {
            await originalSyncBadges();
            
            // Generate activity based on task changes
            if (currentTasks && currentTasks.length > 0) {
                const activeTasks = currentTasks.filter(task => 
                    task.status === 'In Progress' || task.status === 'Not Started'
                );
                
                // Check for newly assigned tasks (simple demo)
                activeTasks.forEach(task => {
                    if (task.assignee && Math.random() < 0.1) { // 10% chance to show activity
                        const agentKey = findAgentKey(task.assignee);
                        const agentIcon = agentKey ? AGENT_ICONS[agentKey] : 'ü§ñ';
                        const action = task.status === 'In Progress' ? 'working on' : 'assigned to';
                        
                        addActivityEvent(
                            task.status === 'In Progress' ? 'claim' : 'assign',
                            `${task.assignee} ${action} ${task.taskId}`,
                            agentIcon,
                            task.url
                        );
                    }
                });
            }
        };

        // Hook into location system for movement events  
        const originalUpdateAgentLocation = updateAgentLocation;
        updateAgentLocation = function(agentKey, newLocation, newStatus) {
            const oldLocation = agentStates[agentKey]?.location;
            originalUpdateAgentLocation(agentKey, newLocation, newStatus);
            
            // Generate movement activity
            if (oldLocation && oldLocation !== newLocation && Math.random() < 0.3) {
                const agentIcon = AGENT_ICONS[agentKey];
                const locationName = newLocation === 'desk' ? 'workstation' : newLocation;
                addActivityEvent('move', `${agentKey} moved to ${locationName}`, agentIcon);
            }
        };

        // Ticker controls
        function pauseTicker() {
            document.getElementById('activityTicker').classList.add('ticker-paused');
        }

        function resumeTicker() {
            document.getElementById('activityTicker').classList.remove('ticker-paused');
        }

        // Export for debugging
        window.activityFeed = {
            events: () => activityEvents,
            add: addActivityEvent,
            pause: pauseTicker,
            resume: resumeTicker,
            init: initializeActivityFeed
        };
    </script>

    
    <script>
        // Integration layer - connecting Epsilon's state system with the existing UI
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üêô Office integrated with Epsilon State Management!');
            
            // Start real-time badge sync
            startBadgeSync();
            console.log('üéØ Real-time badge sync initialized!');
            
            // Initialize agent location awareness
            initializeAgentLocations();
            console.log('üó∫Ô∏è Agent location awareness initialized!');
            
            // Start periodic shuffling of idle agents
            setInterval(shuffleIdleAgents, 45000); // Every 45 seconds
            
            // Initialize activity feed ticker
            initializeActivityFeed();
            console.log('üì∞ Activity feed ticker initialized!');
            
            // Listen to state events for enhanced UI feedback
            window.officeState.on('taskAssigned', (data) => {
                console.log(`üéØ Task ${data.taskId} assigned to ${data.agentName}`);
                // Could trigger confetti or other celebration effects
            });
            
            window.officeState.on('taskCompleted', (data) => {
                console.log(`‚úÖ Task ${data.taskId} completed by ${data.agentName}`);
                // Trigger mail chute animation
                sendMail();
            });
            
            window.officeState.on('agentWoke', (data) => {
                console.log(`üò¥‚Üíüòä Agent ${data.agentName} woke up!`);
            });
            
            // Auto-assign tasks periodically for demo (every 45-75 seconds, reduced chance)
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% chance (reduced from 30% to prevent conflicts)
                    window.officeState.simulateTaskAssignment();
                }
            }, 60000); // Increased interval to reduce conflicts
            
            // Enhanced mail chute with state integration
            const originalSendMail = window.sendMail;
            window.sendMail = function() {
                originalSendMail();
                console.log('üì¨ Message sent through Epsilon-enhanced mail chute!');
            };
        });
        
        // Epsilon's sequence diagram printer (because I love complexity!)
        function printSequenceDiagram() {
            console.log(`
üêô EPSILON'S OFFICE WORKFLOW SEQUENCE DIAGRAM:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   TASK      ‚îÇ    ‚îÇ   AGENT     ‚îÇ    ‚îÇ   KANBAN    ‚îÇ    ‚îÇ   MESSAGE   ‚îÇ
‚îÇ ASSIGNMENT  ‚îÇ    ‚îÇ  LIFECYCLE  ‚îÇ    ‚îÇ   BOARD     ‚îÇ    ‚îÇ   SYSTEM    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ assignTask()     ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ wakeAgent()      ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ moveToBoard()    ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ claimTask()      ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ moveToDesk()     ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ startWorking()   ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ   ... work ...   ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ completeTask()   ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ sendMessage()    ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ returnToSleep()  ‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                  ‚îÇ
       ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
       
üêô Each step involves state transitions, UI updates, animations, 
   event emissions, and persistent storage. TENTACLES EVERYWHERE!
            `);
        }
        
        // Add to debug interface
        window.epsilon.sequenceDiagram = printSequenceDiagram;
        
        console.log('üêô Integration complete! Try these commands:');
        console.log('  epsilon.simulate() - Assign a random task');
        console.log('  epsilon.getState() - View full system state');
        console.log('  epsilon.sequenceDiagram() - View workflow diagram');
        console.log('  epsilon.tentacles - See my beautiful tentacles!');
    </script>

    <!-- Activity Feed Ticker -->
    <div class="activity-ticker" id="activityTicker">
        <div class="ticker-content" id="tickerContent">
            <!-- Activity events will be populated here -->
        </div>
    </div>
</body>
</html>
